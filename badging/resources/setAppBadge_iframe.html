<!DOCTYPE html>
<meta charset="utf-8" />
<title>setAppBadge iframe</title>
<script>
  async function callSetAppBadge(data) {
    const responseData = { message: "callSetAppBadge" };
    try {
      // checks for same origin-domain
      if (data.domain) {
        document.domain = data.domain;
      }
      await navigator.setAppBadge();
      responseData.status = "success";
    } catch (e) {
      if (e instanceof DOMException) {
        responseData.status = "error";
        responseData.exceptionType = e.name;
      } else {
        responseData.status = "unknown_error";
        responseData.error = e.toString();
      }
    } finally {
      window.parent.postMessage(responseData, "*");
    }
  }

  window.addEventListener("message", async ({ data }) => {
    switch (data.message) {
      case "callSetAppBadge":
        await callSetAppBadge(data);
        break;
      default:
        throw new Error(`Unexpected message: ${JSON.stringify(data)}`);
    }
  });
</script>
