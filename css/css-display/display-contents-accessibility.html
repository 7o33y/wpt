<!doctype html>
<html>
<head>
  <title>Testing accessibility of display: contents</title>
  <script src="/resources/testharness.js"></script>
  <script src="/resources/testharnessreport.js"></script>
  <script src="/resources/testdriver.js"></script>
  <script src="/resources/testdriver-vendor.js"></script>
  <script src="/resources/testdriver-actions.js"></script>
  <script src="/wai-aria/scripts/aria-utils.js"></script>
</head>
<body>

    <h1>Testing accessibility of display: contents</h1>

    <p>Verifies accessibility behavior of the <a href="https://www.w3.org/TR/css-display-3/#box-generation">contents</a> keyword for the CSS display property</p>

    <!-- Dec 2023 notes for "display: contents" testing:

    - From the CSS Display Module Level 3 spec (https://www.w3.org/TR/css-display-3/#box-generation), "display: contents" behaves as such:
    "The element itself does not generate any boxes, but its children and pseudo-elements still generate boxes and text sequences as normal.
    For the purposes of box generation and layout, the element must be treated as if it had been replaced in the element tree by its contents (including both its source-document children
    and its pseudo-elements, such as ::before and ::after pseudo-elements, which are generated before/after the elementâ€™s children as normal)."

    - Per CSS spec, setting "display: contents" must not alter an element's semantics (https://www.w3.org/TR/css-display-3/#valdef-display-contents):
    "As only the box tree is affected, any semantics based on the document tree, such as selector-matching, event handling, and
    property inheritance, are not affected."

    - Categorizing behavior of "display: contents" for HTML elements (https://www.w3.org/TR/css-display-3/#unbox-html):
        (1) Compute the same as "display: none":
            <br>
            <wbr>
            <meter?
            <progress>
            <canvas>
            <embed>
            <object>
            <audio>
            <iframe>
            <img>
            <video>
            <frame>
            <frameset>
            <input>
            <textarea>
            <select>

        (2) Not rendered, but behave as intended with "display: contents":
            <legend>

        (3) No special behavior, behave as intended with "display: contents":
            <button>
            <details>
            <fieldset>

        (4) Behave as intended with "display: contents":
            All other HTML elements.

    - As of December 2023, the current state of cross-browser, automated web accessibility testing is limited to retrieving the following
    accessibility object properties with planned future enhancements (https://github.com/WICG/aom/issues/203):
        - computedRole
        - computedLabel

    Thus, the following has been currently identified as testable when "display: contents" is supplied:
        - HTML elements retain their semantic role (such as <h#>, <th>, <td>, <button>, <svg>)
        - HTML elements and their accessible name calculation is unaffected (https://w3c.github.io/accname/#computation-steps)

    The following is not currently testable:
        - Focusability of controls (tracked globally in mozilla/standards-positions repo: https://github.com/mozilla/standards-positions/issues/772)

        - Reading order such table cells

        - Expected keyboard operability such as links remaining operable with Enter/Return

        - Hidden elements as a result of "display: contents"

        - <table> structure such as accessibility row or column count
    -->

    <!-- Generic example: <footer data-testname="footer element scoped to main element is generic" class="ex-generic">x</footer> -->
    <!-- Role example: <div role="contentinfo" data-testname="contentinfo region scoped to body element is contentinfo" data-expectedrole="contentinfo" class="ex">x</div> -->

    <!-- HTML elements testing  -->
    <h2>HTML elements testing for <code>display: contents</code></h2>

    <!-- Explicit ARIA role assignment testing  -->
    <h2>Explicit ARIA role assignment testing for <code>display: contents</code></h2>


    <script>
        AriaUtils.verifyRolesBySelector(".ex");
        AriaUtils.verifyGenericRolesBySelector(".ex-generic");
    </script>

</body>
</html>