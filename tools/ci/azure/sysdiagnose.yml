steps:
- script: |
    mkdir -p "/Users/runner/sysdiagnose-$(Agent.JobName)"
    # No UI, and no time sensitive, generated, or archived logs
    sudo sysdiagnose -ub -f "/Users/runner/sysdiagnose-$(Agent.JobName)" -A "sysdiagnose_$(System.JobPositionInPhase)"
  displayName: 'Collect sysdiagnose'
  condition: and(succeeded(), eq(variables['Agent.OS'], 'Darwin'))
- task: PublishBuildArtifacts@1
  displayName: 'Publish sysdiagnose'
  inputs:
    pathtoPublish: "/Users/runner/sysdiagnose-$(Agent.JobName)/"
    artifactName: "sysdiagnose-$(Agent.JobName)"
  condition: and(succeeded(), eq(variables['Agent.OS'], 'Darwin'))
